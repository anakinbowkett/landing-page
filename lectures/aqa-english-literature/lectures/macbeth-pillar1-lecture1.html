<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lowest Common Multiple - Interactive Lecture</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#ffffff;
  --muted:#6b7280;
  --accent:#1d7fe2;
  --card:#f8fafc;
  --panel-gap:24px;
  --step-bg:#fff;
  --arrow:#cbd5e1;
  --glass: rgba(255,255,255,0.6);
  --border:#e5e7eb;
  --text-primary:#111827;
  --text-secondary:#6b7280;
}

html,body{
  height:100%;
  margin:0;
  background:var(--bg);
  font-family:Inter,system-ui,Segoe UI,Arial;
  color:#111;
  padding-top:110px;
  padding-bottom:60px;
}

.wrap{
  max-width:1400px;
  margin:24px auto;
  padding:28px;
  display:grid;
  grid-template-columns: 1fr 500px;
  gap:var(--panel-gap);
  display:none !important;
}

@media (max-width: 980px){ 
  .wrap{
    grid-template-columns:1fr;
    padding:16px;
    margin:20px auto;
  }
}

.header-bar-1 {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  width: 100%;
  height: 55px;
  background: #ffffff;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 24px;
  z-index: 100;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.lectures-back-btn {
  position: absolute;
  left: 24px;
  font-size: 14px;
  font-weight: 600;
  color: var(--accent);
  text-decoration: none;
  display: flex;
  align-items: center;
  gap: 8px;
}

.lectures-back-btn svg {
  width: 20px;
  height: 20px;
}

.lectures-back-btn:hover {
  opacity: 0.8;
}

.reference-btn {
  position: absolute;
  right: 220px;  /* Changed from 200px to add more space */
  font-size: 14px;
  font-weight: 600;
  color: white;
  background: #daa98a;  /* Changed from #1d7fe2 to your new color */
  border: none;
  padding: 8px 16px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.reference-btn:hover {
  background: #c4916f;  /* Darker shade for hover effect */
}

.formula-sheet-btn {
  position: absolute;
  right: 80px;
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
  background: white;
  border: 1px solid var(--border);
  padding: 8px 16px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.formula-sheet-btn:hover {
  background: #f9fafb;
  border-color: var(--accent);
  color: var(--accent);
}

.progress-container {
  width: 50%;
  max-width: 600px;
  height: 8px;
  background: #f3f4f6;
  border-radius: 10px;
  overflow: hidden;
  display: flex;
}

.progress-segment {
  height: 100%;
  transition: all 0.3s ease;
}

.header-bar-2 {
  position: fixed;
  top: 55px;
  left: 0;
  right: 0;
  width: 100%;
  height: 55px;
  background: #ffffff;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  padding: 0 24px;
  z-index: 99;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.format-toggle {
  display: flex;
  align-items: center;
  gap: 0;
  background: #f9fafb;
  border-radius: 8px;
  padding: 4px;
  border: 1px solid var(--border);
}

.format-btn {
  padding: 8px 20px;
  font-size: 14px;
  font-weight: 600;
  color: var(--text-secondary);
  background: transparent;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.format-btn.active {
  background: #ffffff;
  color: var(--text-primary);
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.format-divider {
  width: 1px;
  height: 24px;
  background: var(--border);
}

.lecture-objective-box {
  background: #fff;
  border-radius: 12px;
  padding: 28px 32px;
  box-shadow: 0 6px 24px rgba(16, 24, 40, 0.06);
  max-width: 1400px;
  width: calc(100% - 56px);
  margin: 0 auto 24px auto;
  border: 1px solid #f0f0f0;
  box-sizing: border-box;
}

.lecture-objective-title {
  font-family: 'Crimson Text', serif;
  font-size: 32px;
  font-weight: 600;
  color: #000000;
  letter-spacing: -0.09em;
  line-height: 1.2;
  margin: 0 0 16px 0;
}

.lecture-objective-content {
  font-family: Inter, system-ui, 'Segoe UI', Arial, sans-serif;
  font-size: 16px;
  color: #464e5a;
  line-height: 1.6;
  margin: 0;
}

.lecture-objective-list {
  list-style: none;
  padding: 0;
  margin: 12px 0 0 0;
}

.lecture-objective-list li {
  padding-left: 24px;
  position: relative;
  margin-bottom: 8px;
  color: #464e5a;
}

.lecture-objective-list li:before {
  content: "•";
  position: absolute;
  left: 8px;
  color: #1d7fe2;
  font-weight: bold;
}

.main-container {
  display: flex;
  height: calc(100vh - 110px);
  width: 100%;
  margin-top: 110px;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.content-side {
  width: 66.666%;
  height: 100%;
  overflow-y: auto;
  overflow-x: hidden;
  background: #ffffff;
}

.chat-side {
  width: 33.333%;
  height: 100%;
  background: #ffffff;
  border-left: 1px solid #e5e7eb;
  display: flex;
  flex-direction: column;
}

.chat-header {
  padding: 20px 24px;
  border-bottom: 1px solid var(--border);
  background: white;
  flex-shrink: 0;
}

.chat-title {
  font-size: 18px;
  font-weight: 700;
  color: var(--text-primary);
  margin: 0 0 4px 0;
}

.chat-subtitle {
  font-size: 13px;
  color: var(--text-secondary);
  margin: 0;
}

.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 24px;
  background: #f9fafb;
}

.message {
  margin-bottom: 16px;
  display: flex;
  flex-direction: column;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.message-user {
  align-items: flex-end;
}

.message-assistant {
  align-items: flex-start;
}

.message-label {
  font-size: 12px;
  font-weight: 600;
  color: var(--text-secondary);
  margin-bottom: 6px;
}

.message-bubble {
  max-width: 85%;
  padding: 12px 16px;
  border-radius: 12px;
  line-height: 1.5;
  font-size: 14px;
}

.message-user .message-bubble {
  background: var(--accent);
  color: white;
  border-bottom-right-radius: 4px;
}

.message-assistant .message-bubble {
  background: white;
  color: var(--text-primary);
  border: 1px solid var(--border);
  border-bottom-left-radius: 4px;
}

.chat-input-area {
  padding: 16px 24px;
  border-top: 1px solid var(--border);
  background: white;
  flex-shrink: 0;
}

.prompts-btn {
  width: 100%;
  padding: 12px;
  background: white;
  border: 1px solid var(--border);
  border-radius: 12px;
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
  cursor: pointer;
  transition: all 0.2s ease;
  margin-bottom: 12px;
}

.prompts-btn:hover {
  background: #f9fafb;
  border-color: var(--accent);
  color: var(--accent);
}

.chat-input-wrapper {
  display: flex;
  gap: 8px;
  align-items: flex-end;
}

.chat-input {
  flex: 1;
  padding: 12px 16px;
  border: 1px solid var(--border);
  border-radius: 10px;
  font-size: 14px;
  font-family: 'Inter', sans-serif;
  resize: none;
  min-height: 56px;
  max-height: 120px;
  outline: none;
  transition: border-color 0.2s;
  line-height: 1.5;
}

.chat-input:focus {
  border-color: var(--accent);
}

.chat-send-btn {
  padding: 12px 20px;
  background: var(--accent);
  color: white;
  border: none;
  border-radius: 10px;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s;
}

.chat-send-btn:hover {
  background: #1d6fd1;
}

.chat-send-btn:disabled {
  background: #cbd5e1;
  cursor: not-allowed;
}

.question-box-1,
.question-box-2,
.question-box-3,
.question-box-4,
.question-box-5,
.question-box-6 {
  background: #ffffff;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  padding: 32px;
  margin: 20px 32px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  position: relative;
  transition: all 0.3s ease;
  max-width: 1400px;
  width: calc(100% - 64px);
  margin-left: auto;
  margin-right: auto;
  box-sizing: border-box;
  cursor: pointer;
}

.question-box-1.correct,
.question-box-2.correct,
.question-box-3.correct,
.question-box-4.correct,
.question-box-5.correct,
.question-box-6.correct {
  border-color: #54d3ab;
  background: #f0fdf4;
}

.question-box-1.incorrect-selection,
.question-box-2.incorrect-selection,
.question-box-3.incorrect-selection,
.question-box-4.incorrect-selection,
.question-box-5.incorrect-selection,
.question-box-6.incorrect-selection {
  border-color: #e16280;
  background: #fef2f2;
}

.question-number-label-1,
.question-number-label-2,
.question-number-label-3,
.question-number-label-4,
.question-number-label-5,
.question-number-label-6 {
  display: none;
}

.mark-counter-1,
.mark-counter-2,
.mark-counter-3,
.mark-counter-4,
.mark-counter-5,
.mark-counter-6 {
  position: absolute;
  bottom: 32px;
  left: 32px;
  font-size: 14px;
  font-weight: 600;
  color: #6b7280;
  background: #f9fafb;
  padding: 6px 14px;
  border-radius: 6px;
  border: 1px solid #e5e7eb;
  transition: all 0.3s ease;
}

.mark-counter-1.correct,
.mark-counter-2.correct,
.mark-counter-3.correct,
.mark-counter-4.correct,
.mark-counter-5.correct,
.mark-counter-6.correct {
  background: #54d3ab !important;
  color: white !important;
  border-color: #54d3ab !important;
}

.mark-counter-1.incorrect,
.mark-counter-2.incorrect,
.mark-counter-3.incorrect,
.mark-counter-4.incorrect,
.mark-counter-5.incorrect,
.mark-counter-6.incorrect {
  background: #e16280 !important;
  color: white !important;
  border-color: #e16280 !important;
}

.question-title-1,
.question-title-2,
.question-title-3,
.question-title-4,
.question-title-5,
.question-title-6 {
  font-size: 16px !important;
  font-weight: 500;
  color: #111827;
  text-align: center;
  margin: 32px 0 28px 0;
  line-height: 1.6;
}

.answer-container-1,
.answer-container-2,
.answer-container-3,
.answer-container-4,
.answer-container-5,
.answer-container-6 {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin: 0 auto;
  max-width: 600px;
}

.answer-option-1-1,
.answer-option-1-2,
.answer-option-1-3,
.answer-option-1-4,
.answer-option-2-1,
.answer-option-2-2,
.answer-option-2-3,
.answer-option-2-4,
.answer-option-3-1,
.answer-option-3-2,
.answer-option-3-3,
.answer-option-3-4,
.answer-option-4-1,
.answer-option-4-2,
.answer-option-4-3,
.answer-option-4-4,
.answer-option-5-1,
.answer-option-5-2,
.answer-option-5-3,
.answer-option-5-4,
.answer-option-6-1,
.answer-option-6-2,
.answer-option-6-3,
.answer-option-6-4 {
  padding: 16px 20px !important;
  border: 2px solid #e5e7eb !important;
  border-radius: 10px !important;
  font-size: 15px !important;
  font-weight: 450 !important;
  color: #1f2937 !important;
  background: #ffffff !important;
  cursor: pointer;
  transition: all 0.2s ease;
  text-align: left !important;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Inter", sans-serif !important;
  line-height: 1.55 !important;
  letter-spacing: -0.01em !important;
}

.answer-option-1-1:hover:not(:disabled),
.answer-option-1-2:hover:not(:disabled),
.answer-option-1-3:hover:not(:disabled),
.answer-option-1-4:hover:not(:disabled),
.answer-option-2-1:hover:not(:disabled),
.answer-option-2-2:hover:not(:disabled),
.answer-option-2-3:hover:not(:disabled),
.answer-option-2-4:hover:not(:disabled),
.answer-option-3-1:hover:not(:disabled),
.answer-option-3-2:hover:not(:disabled),
.answer-option-3-3:hover:not(:disabled),
.answer-option-3-4:hover:not(:disabled),
.answer-option-4-1:hover:not(:disabled),
.answer-option-4-2:hover:not(:disabled),
.answer-option-4-3:hover:not(:disabled),
.answer-option-4-4:hover:not(:disabled),
.answer-option-5-1:hover:not(:disabled),
.answer-option-5-2:hover:not(:disabled),
.answer-option-5-3:hover:not(:disabled),
.answer-option-5-4:hover:not(:disabled),
.answer-option-6-1:hover:not(:disabled),
.answer-option-6-2:hover:not(:disabled),
.answer-option-6-3:hover:not(:disabled),
.answer-option-6-4:hover:not(:disabled) {
  border-color: #1d7fe2 !important;
  background: #f0f9ff !important;
}

.answer-option-1-1.selected,
.answer-option-1-2.selected,
.answer-option-1-3.selected,
.answer-option-1-4.selected,
.answer-option-2-1.selected,
.answer-option-2-2.selected,
.answer-option-2-3.selected,
.answer-option-2-4.selected,
.answer-option-3-1.selected,
.answer-option-3-2.selected,
.answer-option-3-3.selected,
.answer-option-3-4.selected,
.answer-option-4-1.selected,
.answer-option-4-2.selected,
.answer-option-4-3.selected,
.answer-option-4-4.selected,
.answer-option-5-1.selected,
.answer-option-5-2.selected,
.answer-option-5-3.selected,
.answer-option-5-4.selected,
.answer-option-6-1.selected,
.answer-option-6-2.selected,
.answer-option-6-3.selected,
.answer-option-6-4.selected {
  border-color: #1d7fe2 !important;
  background: #1d7fe2 !important;
  color: white !important;
}

.answer-option-1-1.correct-answer,
.answer-option-1-2.correct-answer,
.answer-option-1-3.correct-answer,
.answer-option-1-4.correct-answer,
.answer-option-2-1.correct-answer,
.answer-option-2-2.correct-answer,
.answer-option-2-3.correct-answer,
.answer-option-2-4.correct-answer,
.answer-option-3-1.correct-answer,
.answer-option-3-2.correct-answer,
.answer-option-3-3.correct-answer,
.answer-option-3-4.correct-answer,
.answer-option-4-1.correct-answer,
.answer-option-4-2.correct-answer,
.answer-option-4-3.correct-answer,
.answer-option-4-4.correct-answer,
.answer-option-5-1.correct-answer,
.answer-option-5-2.correct-answer,
.answer-option-5-3.correct-answer,
.answer-option-5-4.correct-answer,
.answer-option-6-1.correct-answer,
.answer-option-6-2.correct-answer,
.answer-option-6-3.correct-answer,
.answer-option-6-4.correct-answer {
  border-color: #54d3ab !important;
  background: #54d3ab !important;
  color: white !important;
}

.submit-button-1,
.submit-button-2,
.submit-button-3,
.submit-button-4,
.submit-button-5,
.submit-button-6 {
  margin: 24px auto 0 !important;
  padding: 12px 32px !important;
  background: #1d7fe2 !important;
  color: white !important;
  border: none !important;
  border-radius: 8px !important;
  font-size: 15px !important;
  font-weight: 600 !important;
  cursor: pointer;
  transition: all 0.2s ease;
  display: block;
}

.submit-button-1:hover,
.submit-button-2:hover,
.submit-button-3:hover,
.submit-button-4:hover,
.submit-button-5:hover,
.submit-button-6:hover {
  background: #1d6fd1 !important;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(29, 127, 226, 0.3);
}
  
  
/* ============================================
   ENGLISH LITERATURE QUESTION DESIGN
   ============================================ */

.question-header-container {
  display: flex;
  align-items: flex-start;
  gap: 16px;
  margin-bottom: 20px;
  position: relative;
}

.question-number-box {
  flex-shrink: 0;
  width: 50px;
  height: 28px;
  border: 1px solid #000;
  display: flex;
  align-items: stretch;
  justify-content: center;
  gap: 3px;
  background: white;
  font-family: Arial, sans-serif;
  padding: 0;
}

.q-num-small {
  font-size: 16px;
  font-weight: 400;
  color: #000;
  display: flex;
  align-items: center;
}

.q-num-divider {
  font-size: 28px;
  font-weight: 200;
  color: #000;
  margin: 0;
  padding: 0;
  line-height: 1;
  display: flex;
  align-items: stretch;
  align-self: stretch;
}

.q-num-large {
  font-size: 16px;
  font-weight: 400;
  color: #000;
  display: flex;
  align-items: center;
}

.question-instruction {
  flex: 1;
  font-size: 15.5px;
  line-height: 1.4;
  color: #000;
  font-family: Arial, sans-serif;
  padding-top: 4px;
}

.do-not-write-notice {
  display: none;
}

.extract-box {
  border: 1px solid #000;
  padding: 16px;
  margin: 16px 0;
  background: white;
  font-family: Arial, sans-serif;
}

.extract-box p {
  font-size: 15.5px;
  line-height: 1.45;
  color: #000;
  margin: 0;
  text-align: justify;
}

.question-prompt-text {
  font-size: 15.5px;
  font-weight: 400;
  color: #000;
  margin: 18px 0 12px 0;
  font-family: Arial, sans-serif;
  line-height: 1.4;
}

.writing-guidance {
  font-size: 15px;
  color: #000;
  margin: 12px 0;
  font-family: Arial, sans-serif;
}

.writing-guidance ul {
  margin: 6px 0 0 0;
  padding-left: 20px;
}

.writing-guidance li {
  margin-bottom: 2px;
  line-height: 1.4;
}

.marks-indicator {
  text-align: right;
  font-size: 15.5px;
  font-weight: 700;
  color: #000;
  margin: 12px 0 20px 0;
  font-family: Arial, sans-serif;
}

/* Writing Lines */
.writing-lines-container {
  margin: 32px 0;
  position: relative;
  background: white;
  padding: 0 16px;
}

.writing-line {
  min-height: 44px;
  padding: 0 4px;
  margin-bottom: 4px;
  border-bottom: 1px solid #000;
  font-size: 32px;
  line-height: 1.35;
  color: #000;
  font-family: 'Crimson Text', serif;
  font-weight: 400;
  letter-spacing: -0.02em;
  cursor: text;
  transition: background 0.2s ease;
  position: relative;
  display: block;
  white-space: nowrap;
  overflow: hidden;
  box-sizing: border-box;
}

.writing-line:hover {
  background: #fafafa;
}

.writing-line:focus {
  outline: none;
  background: #fff;
}

.writing-line[contenteditable]:empty:before {
  content: attr(placeholder);
  color: #999;
  font-style: italic;
  pointer-events: none;
}

/* AI Annotations Container */
.ai-annotations-container {
  position: relative;
  margin: 24px 0;
  display: none; /* Hidden until marking happens */
}

.ai-annotation {
  font-size: 11px;
  line-height: 1.2;
  color: #e16280;
  font-family: 'Crimson Text', serif;
  font-style: italic;
  margin-bottom: 2px;
  padding: 0;
  background: transparent;
  border: none;
  position: relative;
  animation: fadeInAnnotation 0.4s ease forwards;
  opacity: 0;
}

.ai-annotation.warning {
  color: #e16280;
}

.highlight-red {
  background: linear-gradient(120deg, transparent 0%, #e16280 50%, transparent 100%);
  background-repeat: no-repeat;
  background-size: 200% 60%;
  background-position: -100% 90%;
  animation: highlightSweep 1.2s ease forwards;
  animation-delay: 0.3s;
  color: white;
}

.highlight-yellow {
  display: none;
}

@keyframes fadeInAnnotation {
  to {
    opacity: 1;
  }
}

.ai-annotation.positive {
  color: #0b7e45;
  border-left-color: #0b7e45;
  background: rgba(232, 245, 233, 0.9);
}

.ai-annotation.warning {
  color: #d97706;
  border-left-color: #d97706;
  background: rgba(254, 243, 199, 0.9);
}

/* Highlighting Animation */
@keyframes highlightSweep {
  0% {
    background-position: -100% 90%;
  }
  100% {
    background-position: 100% 90%;
  }
}

.highlight-green {
  background: linear-gradient(120deg, transparent 0%, #d4f4dd 50%, transparent 100%);
  background-repeat: no-repeat;
  background-size: 200% 40%;
  background-position: -100% 90%;
  animation: highlightSweep 1.2s ease forwards;
  animation-delay: 0.3s;
  font-weight: 500;
}

.highlight-yellow {
  background: linear-gradient(120deg, transparent 0%, #fef3c7 50%, transparent 100%);
  background-repeat: no-repeat;
  background-size: 200% 40%;
  background-position: -100% 90%;
  animation: highlightSweep 1.2s ease forwards;
  animation-delay: 0.3s;
}

.highlight-red {
  background: linear-gradient(120deg, transparent 0%, #fee2e2 50%, transparent 100%);
  background-repeat: no-repeat;
  background-size: 200% 40%;
  background-position: -100% 90%;
  animation: highlightSweep 1.2s ease forwards;
  animation-delay: 0.3s;
}

/* Scanning Effect Overlay */
.scanning-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 42px;
  background: linear-gradient(to bottom, 
    transparent 0%, 
    rgba(29, 127, 226, 0.1) 50%, 
    transparent 100%);
  pointer-events: none;
  opacity: 0;
  animation: scanDown 3s ease-in-out forwards;
  z-index: 10;
}

@keyframes scanDown {
  0% {
    top: 0;
    opacity: 0;
  }
  5% {
    opacity: 0.8;
  }
  95% {
    opacity: 0.8;
  }
  100% {
    top: 100%;
    opacity: 0;
  }
}

/* Submit Button Styling */
.submit-button-1,
.submit-button-2,
.submit-button-3,
.submit-button-4,
.submit-button-5,
.submit-button-6 {
  margin: 32px auto 0 !important;
  padding: 14px 48px !important;
  background: #1d7fe2 !important;
  color: white !important;
  border: none !important;
  border-radius: 8px !important;
  font-size: 16px !important;
  font-weight: 600 !important;
  cursor: pointer;
  transition: all 0.3s ease;
  display: block;
  font-family: Arial, sans-serif !important;
}

.submit-button-1:hover,
.submit-button-2:hover,
.submit-button-3:hover,
.submit-button-4:hover,
.submit-button-5:hover,
.submit-button-6:hover {
  background: #1d6fd1 !important;
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(29, 127, 226, 0.4);
}

.submit-button-1:disabled,
.submit-button-2:disabled,
.submit-button-3:disabled,
.submit-button-4:disabled,
.submit-button-5:disabled,
.submit-button-6:disabled {
  background: #cbd5e1 !important;
  cursor: not-allowed;
  transform: none;
}
  

  /* Add Page Controls */
.add-page-controls {
  text-align: center;
  margin: 24px 0 32px 0;
}

.add-page-btn {
  padding: 10px 28px;
  background: white;
  color: #1d7fe2;
  border: 2px solid #1d7fe2;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  font-family: Arial, sans-serif;
}

.add-page-btn:hover {
  background: #1d7fe2;
  color: white;
}

.add-page-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Additional Pages */
.additional-pages-container {
  margin-top: 40px;
}

.writing-page {
  background: white;
  border: 1px solid #000;
  padding: 32px;
  margin-bottom: 32px;
  position: relative;
  min-height: 600px;
}

.writing-page .writing-lines-container {
  margin: 0;
  padding: 0 16px;
}

.page-number {
  position: absolute;
  bottom: 16px;
  left: 16px;
  font-size: 13px;
  font-weight: 600;
  color: #666;
  font-family: Arial, sans-serif;
}
  
  

/* Marked State */
.question-box-1.marked,
.question-box-2.marked,
.question-box-3.marked,
.question-box-4.marked,
.question-box-5.marked,
.question-box-6.marked {
  border-color: #54d3ab;
}

.question-box-1.marked .ai-annotations-container,
.question-box-2.marked .ai-annotations-container,
.question-box-3.marked .ai-annotations-container,
.question-box-4.marked .ai-annotations-container,
.question-box-5.marked .ai-annotations-container,
.question-box-6.marked .ai-annotations-container {
  display: block;
}  
  
  
  

.question-navigation-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 32px;
  margin: 20px 32px;
  background: #ffffff;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  max-width: 1400px;
  width: calc(100% - 64px);
  margin-left: auto;
  margin-right: auto;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
}

.nav-button {
  padding: 10px 24px;
  font-size: 14px;
  font-weight: 600;
  border: 2px solid #1d7fe2;
  border-radius: 8px;
  background: #ffffff;
  color: #1d7fe2;
  cursor: pointer;
  transition: all 0.2s ease;
  min-width: 100px;
  text-align: center;
}

.nav-button:hover:not(:disabled) {
  background: #1d7fe2;
  color: white;
}

.nav-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  border-color: #cbd5e1;
  color: #cbd5e1;
}

.question-counter {
  font-size: 15px;
  font-weight: 600;
  color: #111827;
  padding: 8px 16px;
  background: #f9fafb;
  border-radius: 6px;
  border: 1px solid #e5e7eb;
}

.quiz-progress-container {
  width: 41.6%;
  height: 9px;
  background-color: #f2f2f2;
  border-radius: 10px;
  overflow: hidden;
  margin: 0 auto;
  position: relative;
}

.quiz-progress-segments {
  display: flex;
  width: 100%;
  height: 100%;
}

.quiz-segment {
  height: 100%;
  transition: all 1s ease-out;
  border-right: 2px solid white;
  position: relative;
  background-color: transparent;
}

.quiz-segment:last-child {
  border-right: none;
}

.quiz-segment-icon {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 10px;
}
</style>
</head>
<body>

<div class="lecture-objective-box">
  <div class="objective-content-wrapper">
    <h1 class="lecture-objective-title">Product of Prime Factors</h1>
    <div class="lecture-objective-content">
      <p style="margin: 0 0 8px 0; font-weight: 600; color: #0b2546;">Lecture Objective:</p>
      <ul class="lecture-objective-list">
        <li>Master the full principles of the Product of Prime Factors</li>
      </ul>
    </div>
  </div>
</div>

<div class="header-bar-1">
  <a href="../lectures.html" class="lectures-back-btn">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
      <polyline points="9 22 9 12 15 12 15 22"></polyline>
    </svg>
    <span>Lectures</span>
  </a>
  
  <div class="quiz-progress-container">
    <div class="quiz-progress-segments" id="progress-segments">
    </div>
  </div>
  
  <button class="reference-btn" id="referenceBtn">
  Reference
</button>

<button class="formula-sheet-btn" id="formulaSheetBtn">
  Formula Sheet
</button>
</div>

<div class="header-bar-2">
  <div class="format-toggle">
    <button class="format-btn active" id="multipleChoiceBtn" onclick="switchFormat('multiple-choice')">
      Multiple Choice
    </button>
    <div class="format-divider"></div>
    <button class="format-btn" id="examFormatBtn" onclick="switchFormat('exam')">
      Exam Format
    </button>
  </div>
</div>

<div class="main-container">
  <div class="content-side" id="contentSide">

<!-- QUESTION 1 - ENGLISH LITERATURE FORMAT -->
<div class="question-box-1" id="question-box-1">
  <div class="question-number-label-1">Q1 of 6</div>
  <div class="mark-counter-1" id="mark-counter-1">0/8</div>
  
  <!-- Question Header -->
  <div class="question-header-container">
    <div class="question-number-box">
      <span class="q-num-small">0</span>
      <span class="q-num-divider">|</span>
      <span class="q-num-large">2</span>
    </div>
    
    <div class="question-instruction">
      Look in detail at this extract, from lines 10 to 19 of the source:
    </div>
    
  </div>
  
  <!-- Extract Box -->
  <div class="extract-box">
    <p>I am not one to hold a prejudice against any animal, but it is a plain fact that the spotted hyena is not well served by its appearance. It is ugly beyond redemption. Its shaggy, coarse coat is a bungled mix of colours, with the spots having none of the classy ostentation of a leopard's, they look rather like the symptoms of a skin disease, and the animal is broad and too massive, with a high forehead, like that of a bear, but suffering from a receding hairline, and with ears that look ridiculously mouse-like, large and round, when they haven't been torn off in battle. The mouth is forever open and panting. The nostrils are too big. The tail is scraggly and unwavering. All the parts put together look doglike, but like no dog anyone would want as a pet.</p>
  </div>
  
  <!-- Question Prompt -->
  <div class="question-prompt-text">
    How does the writer use language here to describe the hyena's appearance?
  </div>
  
  <!-- Writing Guidance -->
  <div class="writing-guidance">
    You could include the writer's choice of:
    <ul>
      <li>words and phrases</li>
      <li>language features and techniques</li>
      <li>sentence forms.</li>
    </ul>
  </div>
  
  <!-- Mark Allocation -->
  <div class="marks-indicator">[8 marks]</div>
  
  <!-- AI Annotations Container (appears above lines after marking) -->
  <div class="ai-annotations-container" id="ai-annotations-1"></div>
  
  <!-- Writing Lines -->
  <div class="writing-lines-container" id="writing-lines-1">
    <div class="writing-line" contenteditable="true" data-line="1" placeholder="Start typing your answer here..."></div>
    <div class="writing-line" contenteditable="true" data-line="2"></div>
    <div class="writing-line" contenteditable="true" data-line="3"></div>
    <div class="writing-line" contenteditable="true" data-line="4"></div>
    <div class="writing-line" contenteditable="true" data-line="5"></div>
    <div class="writing-line" contenteditable="true" data-line="6"></div>
    <div class="writing-line" contenteditable="true" data-line="7"></div>
    <div class="writing-line" contenteditable="true" data-line="8"></div>
    <div class="writing-line" contenteditable="true" data-line="9"></div>
    <div class="writing-line" contenteditable="true" data-line="10"></div>
  </div>
  
 <button class="submit-button-1" id="submit-button-1" onclick="submitWriting1()">Submit for Marking</button>
  
  <!-- Add Page Button -->
  <div class="add-page-controls">
    <button class="add-page-btn" id="add-page-btn-1" onclick="addWritingPage(1)">
      + Add Page
    </button>
  </div>
  
  <!-- Additional Pages Container -->
  <div class="additional-pages-container" id="additional-pages-1"></div>
</div>

<!-- QUESTION 2 -->
<div class="question-box-2" id="question-box-2">
  <div class="question-number-label-2">Q2 of 6</div>
  <div class="mark-counter-2" id="mark-counter-2">0/1</div>
  <div class="question-title-2">Express 18 as a product of its prime factors.</div>
  <div class="answer-container-2">
    <button class="answer-option-2-1" onclick="toggleSingleAnswer2('option1', this)">2 × 3²</button>
    <button class="answer-option-2-2" onclick="toggleSingleAnswer2('option2', this)">2 × 9</button>
    <button class="answer-option-2-3" onclick="toggleSingleAnswer2('option3', this)">3 × 6</button>
    <button class="answer-option-2-4" onclick="toggleSingleAnswer2('option4', this)">2 × 2 × 9</button>
  </div>
  <button class="submit-button-2" id="submit-button-2" onclick="submitAnswer2()">Submit</button>
</div>

<!-- QUESTION 3 -->
<div class="question-box-3" id="question-box-3">
  <div class="question-number-label-3">Q3 of 6</div>
  <div class="mark-counter-3" id="mark-counter-3">0/1</div>
  <div class="question-title-3">Write 24 as a product of prime factors in index form.</div>
  <div class="answer-container-3">
    <button class="answer-option-3-1" onclick="toggleSingleAnswer3('option1', this)">2³ × 3</button>
    <button class="answer-option-3-2" onclick="toggleSingleAnswer3('option2', this)">2 × 2 × 6</button>
    <button class="answer-option-3-3" onclick="toggleSingleAnswer3('option3', this)">4 × 6</button>
    <button class="answer-option-3-4" onclick="toggleSingleAnswer3('option4', this)">2 × 12</button>
  </div>
  <button class="submit-button-3" id="submit-button-3" onclick="submitAnswer3()">Submit</button>
</div>

<!-- QUESTION 4 -->
<div class="question-box-4" id="question-box-4">
  <div class="question-number-label-4">Q4 of 6</div>
  <div class="mark-counter-4" id="mark-counter-4">0/1</div>
  <div class="question-title-4">Express 30 as a product of its prime factors.</div>
  <div class="answer-container-4">
    <button class="answer-option-4-1" onclick="toggleSingleAnswer4('option1', this)">2 × 3 × 5</button>
    <button class="answer-option-4-2" onclick="toggleSingleAnswer4('option2', this)">2 × 15</button>
    <button class="answer-option-4-3" onclick="toggleSingleAnswer4('option3', this)">3 × 10</button>
    <button class="answer-option-4-4" onclick="toggleSingleAnswer4('option4', this)">5 × 6</button>
  </div>
  <button class="submit-button-4" id="submit-button-4" onclick="submitAnswer4()">Submit</button>
</div>

<!-- QUESTION 5 -->
<div class="question-box-5" id="question-box-5">
  <div class="question-number-label-5">Q5 of 6</div>
  <div class="mark-counter-5" id="mark-counter-5">0/1</div>
  <div class="question-title-5">Write 36 as a product of prime factors in index form.</div>
  <div class="answer-container-5">
    <button class="answer-option-5-1" onclick="toggleSingleAnswer5('option1', this)">2² × 3²</button>
    <button class="answer-option-5-2" onclick="toggleSingleAnswer5('option2', this)">2 × 18</button>
    <button class="answer-option-5-3" onclick="toggleSingleAnswer5('option3', this)">6 × 6</button>
    <button class="answer-option-5-4" onclick="toggleSingleAnswer5('option4', this)">3 × 12</button>
  </div>
  <button class="submit-button-5" id="submit-button-5" onclick="submitAnswer5()">Submit</button>
</div>

<!-- QUESTION 6 -->
<div class="question-box-6" id="question-box-6">
  <div class="question-number-label-6">Q6 of 6</div>
  <div class="mark-counter-6" id="mark-counter-6">0/1</div>
  <div class="question-title-6">Express 48 as a product of prime factors in index form.</div>
  <div class="answer-container-6">
    <button class="answer-option-6-1" onclick="toggleSingleAnswer6('option1', this)">2⁴ × 3</button>
    <button class="answer-option-6-2" onclick="toggleSingleAnswer6('option2', this)">2³ × 3²</button>
    <button class="answer-option-6-3" onclick="toggleSingleAnswer6('option3', this)">4 × 12</button>
    <button class="answer-option-6-4" onclick="toggleSingleAnswer6('option4', this)">2 × 24</button>
  </div>
  <button class="submit-button-6" id="submit-button-6" onclick="submitAnswer6()">Submit</button>
</div>








<div class="question-navigation-bar">
  <button id="nav-prev-btn" class="nav-button" onclick="previousQuestion()">← Previous</button>
  <div class="question-counter" id="question-counter">Question 1 of 6</div>
  <button id="nav-next-btn" class="nav-button" onclick="nextQuestion()">Next →</button>
</div>

  </div>

  <div class="chat-side">
    <div class="chat-header">
      <div class="chat-title"></div>
      <div class="chat-subtitle" id="chatSubtitle">Click a question to get help</div>
    </div>

    <div class="chat-messages" id="chatMessages"></div>

    <div class="chat-input-area">
      <button class="prompts-btn" id="promptsBtn">Prompts</button>
      
      <div class="chat-input-wrapper">
        <textarea id="chatInput" class="chat-input" placeholder="Ask a question..." rows="2"></textarea>
        <button id="sendBtn" class="chat-send-btn">Execute</button>
      </div>
    </div>
  </div>
</div>

  
  




      
</div>



<!-- Reference Guide Modal -->
<div id="referenceModal" style="
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  z-index: 1000;
  overflow-y: auto;
  padding: 40px 20px;
">
  <style>
    #referenceModal .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 60px 40px 100px;
      position: relative;
    }
    
    #referenceModal h1 {
      font-size: 48px;
      font-weight: 600;
      margin-bottom: 70px;
      color: #000000;
      letter-spacing: -0.09em;
      line-height: 1.2;
      font-family: 'Crimson Text', serif;
    }
    
    #referenceModal .definition {
      font-size: 21px;
      color: #2a2a2a;
      margin-bottom: 90px;
      padding-left: 24px;
      border-left: 4px solid #daa98a;
      line-height: 1.6;
    }
    
    #referenceModal .mark-scheme-container {
      background: white;
      border: 2px solid #000;
      margin-bottom: 50px;
      border-radius: 13px;
      overflow: hidden;
    }
    
    #referenceModal .mark-scheme-header {
      background: #000;
      color: white;
      padding: 12px 20px;
      font-size: 15px;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }
    
    #referenceModal .mark-scheme-content {
      display: flex;
    }
    
    #referenceModal .marks-column {
      width: 80px;
      background: #f5f5f5;
      border-right: 2px solid #000;
      flex-shrink: 0;
    }
    
    #referenceModal .mark-item {
      padding: 18px 0;
      text-align: center;
      border-bottom: 1px solid #d0d0d0;
      font-size: 16px;
      font-weight: 600;
      color: #000;
    }
    
    #referenceModal .mark-item:last-child {
      border-bottom: none;
    }
    
    #referenceModal .mistakes-column {
      flex: 1;
    }
    
    #referenceModal .mistake-row {
      padding: 18px 20px;
      border-bottom: 1px solid #d0d0d0;
      font-size: 17px;
      line-height: 1.6;
      color: #1a1a1a;
    }
    
    #referenceModal .mistake-row:last-child {
      border-bottom: none;
    }
    
    #referenceModal .mistake-bold {
      font-weight: 600;
      color: #000;
    }
    
    #referenceModal .question-variations {
      background: linear-gradient(135deg, rgba(218, 169, 138, 0.03) 0%, rgba(218, 169, 138, 0.06) 100%);
      padding: 0;
      border-radius: 13px;
      margin-bottom: 56px;
      border: 0.5px solid rgba(218, 169, 138, 0.12);
      overflow: hidden;
      box-shadow: 0 2px 16px rgba(0, 0, 0, 0.04);
    }
    
    #referenceModal .variations-title {
      font-size: 13px;
      font-weight: 600;
      color: rgba(0, 0, 0, 0.45);
      margin-bottom: 0;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      padding: 24px 28px 12px;
    }
    
    #referenceModal .variation-item {
      font-size: 17px;
      color: #1a1a1a;
      margin-bottom: 0;
      padding: 14px 28px;
      border-top: 0.5px solid rgba(0, 0, 0, 0.06);
      transition: all 0.25s;
      font-weight: 400;
    }
    
    #referenceModal .variation-item:first-of-type {
      border-top: none;
    }
    
    #referenceModal .variation-item:hover {
      background: rgba(218, 169, 138, 0.08);
      padding-left: 32px;
    }
    
    #referenceModal .main-content {
      background: white;
      padding: 60px 55px;
      border-radius: 13px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
      margin-bottom: 90px;
    }
    
    #referenceModal .question {
      font-size: 28px;
      font-weight: 600;
      color: #000000;
      margin-bottom: 55px;
      letter-spacing: -0.02em;
      line-height: 1.3;
    }
    
    #referenceModal .method-title {
      font-size: 18px;
      font-weight: 600;
      color: #daa98a;
      margin-bottom: 35px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    #referenceModal .steps-container {
      margin: 45px 0;
    }

    #referenceModal .step {
      margin-bottom: 60px;
      display: flex;
      gap: 40px;
      align-items: flex-start;
    }

    #referenceModal .step-left {
      flex: 1;
      padding: 28px 0;
    }

    #referenceModal .step-right {
      flex: 1;
      background: white;
      border: 3px solid #daa98a;
      border-radius: 13px;
      padding: 40px;
      height: 220px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #referenceModal .step-number {
      font-size: 15px;
      font-weight: 700;
      color: #daa98a;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 12px;
    }

    #referenceModal .step-intro {
      font-size: 20px;
      font-weight: 600;
      color: #000;
      margin-bottom: 10px;
      line-height: 1.4;
    }

    #referenceModal .step-detail {
      font-size: 18px;
      color: #444;
      line-height: 1.7;
    }

    #referenceModal .step-canvas {
      width: 100%;
      height: 100%;
    }

    #referenceModal .final-answer {
      font-size: 24px;
      font-weight: 700;
      color: #000;
      margin-top: 25px;
      padding: 30px;
      background: #fafafa;
      border-radius: 13px;
      border: 2px solid #daa98a;
      text-align: center;
    }
    
    @media (max-width: 968px) {
      #referenceModal .step {
        flex-direction: column;
      }
      
      #referenceModal .step-right {
        width: 100%;
        height: 200px;
      }
    }
  </style>
  
  <button id="closeModalBtn" style="
    position: fixed;
    top: 60px;
    right: 60px;
    background: #daa98a;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    font-size: 15px;
    z-index: 1001;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    font-family: 'Crimson Text', serif;
  ">Close</button>
























  
  <div id="guideContent">
   <div class="container">
  <h1>Product of Prime Factors</h1>
  
  <div class="definition">
    Writing a number as a multiplication of only prime numbers.
  </div>
  
  <div class="mark-scheme-container">
    <div class="mark-scheme-header">Common Errors & Mark Deductions</div>
    <div class="mark-scheme-content">
      <div class="marks-column">
        <div class="mark-item">-1</div>
        <div class="mark-item">-1</div>
        <div class="mark-item">-1</div>
      </div>
      <div class="mistakes-column">
        <div class="mistake-row">
          <span class="mistake-bold">Stopping too early</span> (e.g., writing 18 = 2 × 9). 9 is not prime. You must keep splitting until all numbers are prime.
        </div>
        <div class="mistake-row">
          <span class="mistake-bold">Missing a factor</span> (e.g., 24 = 2 × 2 × 3). This only makes 12. You’ve lost a factor of 2.
        </div>
        <div class="mistake-row">
          <span class="mistake-bold">Not using index form</span> (e.g., writing 2 × 2 × 2 × 3 instead of 2³ × 3). Foundation questions often ask for index form.
        </div>
      </div>
    </div>
  </div>
  
  <div class="question-variations">
    <div class="variations-title">How Questions Ask This</div>
    <div class="variation-item">Write 24 as a product of its prime factors.</div>
    <div class="variation-item">Express 36 as a product of prime factors in index form.</div>
    <div class="variation-item">Find the prime factorisation of 18.</div>
    <div class="variation-item">Show that 40 = 2³ × 5.</div>
    <div class="variation-item">Complete the prime factor tree for 60.</div>
  </div>
  
  <div class="main-content">
    <div class="question">Write 24 as a product of its prime factors.</div>
    
    <div class="method-title">The Method</div>
    
    <div class="steps-container">
      <div class="step">
        <div class="step-left">
          <div class="step-number">Step One</div>
          <div class="step-intro">Start a factor tree</div>
          <div class="step-detail">
            Write the number at the top. Split it into two factors. Pick easy ones like 2 if the number is even.
          </div>
        </div>
        <div class="step-right">
          <canvas class="step-canvas" id="canvas-step1"></canvas>
        </div>
      </div>
      
      <div class="step">
        <div class="step-left">
          <div class="step-number">Step Two</div>
          <div class="step-intro">Keep splitting</div>
          <div class="step-detail">
            If any number is not prime, split it again. Keep going until all the numbers at the bottom are prime.
          </div>
        </div>
        <div class="step-right">
          <canvas class="step-canvas" id="canvas-step2"></canvas>
        </div>
      </div>
      
      <div class="step">
        <div class="step-left">
          <div class="step-number">Step Three</div>
          <div class="step-intro">Write the answer</div>
          <div class="step-detail">
            Multiply all the prime numbers at the bottom. Use index form if the same prime appears more than once.
          </div>
        </div>
        <div class="step-right">
          <canvas class="step-canvas" id="canvas-step3"></canvas>
        </div>
      </div>
    </div>

    <div class="final-answer">
      24 = 2 × 2 × 2 × 3 = <strong>2³ × 3</strong>
    </div>
  </div>
</div>

<script>
  function setupCanvas(canvas) {
    const dpr = window.devicePixelRatio || 1;
    const rect = canvas.getBoundingClientRect();
    canvas.width = rect.width * dpr;
    canvas.height = rect.height * dpr;
    const ctx = canvas.getContext('2d');
    ctx.scale(dpr, dpr);
    ctx.lineWidth = Math.max(1.5, rect.width * 0.005);
    ctx.strokeStyle = '#daa98a';
    ctx.fillStyle = '#1a1a1a';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    return ctx;
  }

  function circle(ctx, x, y, r) {
    ctx.beginPath();
    ctx.arc(x, y, r, 0, Math.PI * 2);
    ctx.stroke();
  }

  function line(ctx, x1, y1, x2, y2) {
    ctx.beginPath();
    ctx.moveTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.stroke();
  }

  function drawStep1() {
    const canvas = document.getElementById('canvas-step1');
    if (!canvas) return;
    const ctx = setupCanvas(canvas);
    const w = canvas.getBoundingClientRect().width;
    const h = canvas.getBoundingClientRect().height;

    ctx.font = `bold ${w * 0.06}px Crimson Text`;
    ctx.fillText('24', w * 0.5, h * 0.15);

    line(ctx, w * 0.5, h * 0.2, w * 0.3, h * 0.4);
    line(ctx, w * 0.5, h * 0.2, w * 0.7, h * 0.4);

    ctx.font = `${w * 0.05}px Crimson Text`;
    ctx.fillText('2', w * 0.3, h * 0.45);
    ctx.fillText('12', w * 0.7, h * 0.45);
  }

  function drawStep2() {
    const canvas = document.getElementById('canvas-step2');
    if (!canvas) return;
    const ctx = setupCanvas(canvas);
    const w = canvas.getBoundingClientRect().width;
    const h = canvas.getBoundingClientRect().height;

    ctx.font = `bold ${w * 0.06}px Crimson Text`;
    ctx.fillText('24', w * 0.5, h * 0.1);

    line(ctx, w * 0.5, h * 0.15, w * 0.3, h * 0.3);
    line(ctx, w * 0.5, h * 0.15, w * 0.7, h * 0.3);

    ctx.fillText('2', w * 0.3, h * 0.35);
    ctx.fillText('12', w * 0.7, h * 0.35);

    line(ctx, w * 0.7, h * 0.38, w * 0.55, h * 0.55);
    line(ctx, w * 0.7, h * 0.38, w * 0.85, h * 0.55);

    ctx.fillText('2', w * 0.55, h * 0.6);
    ctx.fillText('6', w * 0.85, h * 0.6);
  }

  function drawStep3() {
    const canvas = document.getElementById('canvas-step3');
    if (!canvas) return;
    const ctx = setupCanvas(canvas);
    const w = canvas.getBoundingClientRect().width;
    const h = canvas.getBoundingClientRect().height;

    ctx.font = `bold ${w * 0.06}px Crimson Text`;
    ctx.fillText('24', w * 0.5, h * 0.08);

    line(ctx, w * 0.5, h * 0.13, w * 0.3, h * 0.25);
    line(ctx, w * 0.5, h * 0.13, w * 0.7, h * 0.25);

    ctx.fillText('2', w * 0.3, h * 0.3);
    ctx.fillText('12', w * 0.7, h * 0.3);

    line(ctx, w * 0.7, h * 0.33, w * 0.55, h * 0.48);
    line(ctx, w * 0.7, h * 0.33, w * 0.85, h * 0.48);

    ctx.fillText('2', w * 0.55, h * 0.53);
    ctx.fillText('6', w * 0.85, h * 0.53);

    line(ctx, w * 0.85, h * 0.56, w * 0.75, h * 0.7);
    line(ctx, w * 0.85, h * 0.56, w * 0.95, h * 0.7);

    ctx.fillStyle = '#daa98a';
    ctx.fillText('2', w * 0.75, h * 0.75);
    ctx.fillText('3', w * 0.95, h * 0.75);

    circle(ctx, w * 0.3, h * 0.3, w * 0.04);
    circle(ctx, w * 0.55, h * 0.53, w * 0.04);
    circle(ctx, w * 0.75, h * 0.75, w * 0.04);
    circle(ctx, w * 0.95, h * 0.75, w * 0.04);
  }

  window.drawLCMCanvases = function() {
    drawStep1();
    drawStep2();
    drawStep3();
  };
</script>


  </div>
</div>








  
<script>
// Reference button functionality
document.addEventListener('DOMContentLoaded', function() {
  const referenceBtn = document.getElementById('referenceBtn');
  const closeModalBtn = document.getElementById('closeModalBtn');
  const referenceModal = document.getElementById('referenceModal');
  
 if (referenceBtn) {
  referenceBtn.addEventListener('click', function() {
    referenceModal.style.display = 'block';
    document.body.style.overflow = 'hidden';
    
    // Draw canvases after modal opens
    setTimeout(function() {
      if (typeof window.drawLCMCanvases === 'function') {
        window.drawLCMCanvases();
      }
    }, 100);
  });
}
  
  if (closeModalBtn) {
    closeModalBtn.addEventListener('click', function() {
      referenceModal.style.display = 'none';
      document.body.style.overflow = 'auto';
    });
  }
  
  if (referenceModal) {
    referenceModal.addEventListener('click', function(e) {
      if (e.target === this) {
        this.style.display = 'none';
        document.body.style.overflow = 'auto';
      }
    });
  }
});
</script>  
  
  
  
  
  
  
  
  
  
<script>
// Question answer functions
function toggleSingleAnswer2(answer, button) {
  const questionBox = document.getElementById('question-box-2');
  const allButtons = questionBox.querySelectorAll('[class^="answer-option-2"]');
  allButtons.forEach(btn => btn.classList.remove('selected'));
  button.classList.add('selected');
}

function submitAnswer2() {
  const correctAnswer = '2 × 3²';
  const questionBox = document.getElementById('question-box-2');
  const selectedButtons = questionBox.querySelectorAll('[class^="answer-option-2"].selected');
  const allButtons = questionBox.querySelectorAll('[class^="answer-option-2"]');
  const markCounter = document.getElementById('mark-counter-2');

  const gotItRight = Array.from(selectedButtons).some(btn => btn.textContent.trim() === correctAnswer);
  const yourScore = gotItRight ? 1 : 0;

  markCounter.textContent = `${yourScore}/1`;
  allButtons.forEach(button => {
    if (button.textContent.trim() === correctAnswer) {
      button.classList.add('correct-answer');
    }
    button.disabled = true;
  });

  if (yourScore === 1) {
    markCounter.style.backgroundColor = '#54d3ab';
    markCounter.style.color = 'white';
    questionBox.classList.add('correct');
  } else {
    markCounter.style.backgroundColor = '#e16280';
    markCounter.style.color = 'white';
    questionBox.classList.add('incorrect-selection');
  }

  updateProgressSegment(2);
  const submitBtn = document.getElementById('submit-button-2');
  submitBtn.innerText = 'Reset';
  submitBtn.onclick = resetQuestion2;
}

function resetQuestion2() {
  const questionBox = document.getElementById('question-box-2');
  const buttons = questionBox.querySelectorAll('[class^="answer-option-2"]');
  const submitBtn = document.getElementById('submit-button-2');
  const markCounter = document.getElementById('mark-counter-2');

  buttons.forEach(button => {
    button.classList.remove('selected', 'correct-answer');
    button.disabled = false;
  });

  markCounter.textContent = '0/1';
  markCounter.style.backgroundColor = 'transparent';
  markCounter.style.color = '#555';
  questionBox.classList.remove('correct', 'incorrect-selection');
  resetProgressSegment(2);
  submitBtn.innerText = 'Submit';
  submitBtn.onclick = submitAnswer2;
}

function toggleSingleAnswer3(answer, button) {
  const questionBox = document.getElementById('question-box-3');
  const allButtons = questionBox.querySelectorAll('[class^="answer-option-3"]');
  allButtons.forEach(btn => btn.classList.remove('selected'));
  button.classList.add('selected');
}

function submitAnswer3() {
  const correctAnswer = '2³ × 3';
  const questionBox = document.getElementById('question-box-3');
  const selectedButtons = questionBox.querySelectorAll('[class^="answer-option-3"].selected');
  const allButtons = questionBox.querySelectorAll('[class^="answer-option-3"]');
  const markCounter = document.getElementById('mark-counter-3');

  const gotItRight = Array.from(selectedButtons).some(btn => btn.textContent.trim() === correctAnswer);
  const yourScore = gotItRight ? 1 : 0;

  markCounter.textContent = `${yourScore}/1`;
  allButtons.forEach(button => {
    if (button.textContent.trim() === correctAnswer) {
      button.classList.add('correct-answer');
    }
    button.disabled = true;
  });

  if (yourScore === 1) {
    markCounter.style.backgroundColor = '#54d3ab';
    markCounter.style.color = 'white';
    questionBox.classList.add('correct');
  } else {
    markCounter.style.backgroundColor = '#e16280';
    markCounter.style.color = 'white';
    questionBox.classList.add('incorrect-selection');
  }

  updateProgressSegment(3);
  const submitBtn = document.getElementById('submit-button-3');
  submitBtn.innerText = 'Reset';
  submitBtn.onclick = resetQuestion3;
}

function resetQuestion3() {
  const questionBox = document.getElementById('question-box-3');
  const buttons = questionBox.querySelectorAll('[class^="answer-option-3"]');
  const submitBtn = document.getElementById('submit-button-3');
  const markCounter = document.getElementById('mark-counter-3');

  buttons.forEach(button => {
    button.classList.remove('selected', 'correct-answer');
    button.disabled = false;
  });

  markCounter.textContent = '0/1';
  markCounter.style.backgroundColor = 'transparent';
  markCounter.style.color = '#555';
  questionBox.classList.remove('correct', 'incorrect-selection');
  resetProgressSegment(3);
  submitBtn.innerText = 'Submit';
  submitBtn.onclick = submitAnswer3;
}

function toggleSingleAnswer4(answer, button) {
  const questionBox = document.getElementById('question-box-4');
  const allButtons = questionBox.querySelectorAll('[class^="answer-option-4"]');
  allButtons.forEach(btn => btn.classList.remove('selected'));
  button.classList.add('selected');
}

function submitAnswer4() {
  const correctAnswer = '2 × 3 × 5';
  const questionBox = document.getElementById('question-box-4');
  const selectedButtons = questionBox.querySelectorAll('[class^="answer-option-4"].selected');
  const allButtons = questionBox.querySelectorAll('[class^="answer-option-4"]');
  const markCounter = document.getElementById('mark-counter-4');

  const gotItRight = Array.from(selectedButtons).some(btn => btn.textContent.trim() === correctAnswer);
  const yourScore = gotItRight ? 1 : 0;

  markCounter.textContent = `${yourScore}/1`;
  allButtons.forEach(button => {
    if (button.textContent.trim() === correctAnswer) {
      button.classList.add('correct-answer');
    }
    button.disabled = true;
  });

  if (yourScore === 1) {
    markCounter.style.backgroundColor = '#54d3ab';
    markCounter.style.color = 'white';
    questionBox.classList.add('correct');
  } else {
    markCounter.style.backgroundColor = '#e16280';
    markCounter.style.color = 'white';
    questionBox.classList.add('incorrect-selection');
  }

  updateProgressSegment(4);
  const submitBtn = document.getElementById('submit-button-4');
  submitBtn.innerText = 'Reset';
  submitBtn.onclick = resetQuestion4;
}

function resetQuestion4() {
  const questionBox = document.getElementById('question-box-4');
  const buttons = questionBox.querySelectorAll('[class^="answer-option-4"]');
  const submitBtn = document.getElementById('submit-button-4');
  const markCounter = document.getElementById('mark-counter-4');

  buttons.forEach(button => {
    button.classList.remove('selected', 'correct-answer');
    button.disabled = false;
  });

  markCounter.textContent = '0/1';
  markCounter.style.backgroundColor = 'transparent';
  markCounter.style.color = '#555';
  questionBox.classList.remove('correct', 'incorrect-selection');
  resetProgressSegment(4);
  submitBtn.innerText = 'Submit';
  submitBtn.onclick = submitAnswer4;
}

function toggleSingleAnswer5(answer, button) {
  const questionBox = document.getElementById('question-box-5');
  const allButtons = questionBox.querySelectorAll('[class^="answer-option-5"]');
  allButtons.forEach(btn => btn.classList.remove('selected'));
  button.classList.add('selected');
}

function submitAnswer5() {
  const correctAnswer = '2² × 3²';
  const questionBox = document.getElementById('question-box-5');
  const selectedButtons = questionBox.querySelectorAll('[class^="answer-option-5"].selected');
  const allButtons = questionBox.querySelectorAll('[class^="answer-option-5"]');
  const markCounter = document.getElementById('mark-counter-5');

  const gotItRight = Array.from(selectedButtons).some(btn => btn.textContent.trim() === correctAnswer);
  const yourScore = gotItRight ? 1 : 0;

  markCounter.textContent = `${yourScore}/1`;
  allButtons.forEach(button => {
    if (button.textContent.trim() === correctAnswer) {
      button.classList.add('correct-answer');
    }
    button.disabled = true;
  });

  if (yourScore === 1) {
    markCounter.style.backgroundColor = '#54d3ab';
    markCounter.style.color = 'white';
    questionBox.classList.add('correct');
  } else {
    markCounter.style.backgroundColor = '#e16280';
    markCounter.style.color = 'white';
    questionBox.classList.add('incorrect-selection');
  }

  updateProgressSegment(5);
  const submitBtn = document.getElementById('submit-button-5');
  submitBtn.innerText = 'Reset';
  submitBtn.onclick = resetQuestion5;
}

function resetQuestion5() {
  const questionBox = document.getElementById('question-box-5');
  const buttons = questionBox.querySelectorAll('[class^="answer-option-5"]');
  const submitBtn = document.getElementById('submit-button-5');
  const markCounter = document.getElementById('mark-counter-5');

  buttons.forEach(button => {
    button.classList.remove('selected', 'correct-answer');
    button.disabled = false;
  });

  markCounter.textContent = '0/1';
  markCounter.style.backgroundColor = 'transparent';
  markCounter.style.color = '#555';
  questionBox.classList.remove('correct', 'incorrect-selection');
  resetProgressSegment(5);
  submitBtn.innerText = 'Submit';
  submitBtn.onclick = submitAnswer5;
}

function toggleSingleAnswer6(answer, button) {
  const questionBox = document.getElementById('question-box-6');
  const allButtons = questionBox.querySelectorAll('[class^="answer-option-6"]');
  allButtons.forEach(btn => btn.classList.remove('selected'));
  button.classList.add('selected');
}

function submitAnswer6() {
  const correctAnswer = '2⁴ × 3';
  const questionBox = document.getElementById('question-box-6');
  const selectedButtons = questionBox.querySelectorAll('[class^="answer-option-6"].selected');
  const allButtons = questionBox.querySelectorAll('[class^="answer-option-6"]');
  const markCounter = document.getElementById('mark-counter-6');

  const gotItRight = Array.from(selectedButtons).some(btn => btn.textContent.trim() === correctAnswer);
  const yourScore = gotItRight ? 1 : 0;

  markCounter.textContent = `${yourScore}/1`;
  allButtons.forEach(button => {
    if (button.textContent.trim() === correctAnswer) {
      button.classList.add('correct-answer');
    }
    button.disabled = true;
  });

  if (yourScore === 1) {
    markCounter.style.backgroundColor = '#54d3ab';
    markCounter.style.color = 'white';
    questionBox.classList.add('correct');
  } else {
    markCounter.style.backgroundColor = '#e16280';
    markCounter.style.color = 'white';
    questionBox.classList.add('incorrect-selection');
  }

  updateProgressSegment(6);
  const submitBtn = document.getElementById('submit-button-6');
  submitBtn.innerText = 'Reset';
  submitBtn.onclick = resetQuestion6;
}

function resetQuestion6() {
  const questionBox = document.getElementById('question-box-6');
  const buttons = questionBox.querySelectorAll('[class^="answer-option-6"]');
  const submitBtn = document.getElementById('submit-button-6');
  const markCounter = document.getElementById('mark-counter-6');

  buttons.forEach(button => {
    button.classList.remove('selected', 'correct-answer');
    button.disabled = false;
  });

  markCounter.textContent = '0/1';
  markCounter.style.backgroundColor = 'transparent';
  markCounter.style.color = '#555';
  questionBox.classList.remove('correct', 'incorrect-selection');
  resetProgressSegment(6);
  submitBtn.innerText = 'Submit';
  submitBtn.onclick = submitAnswer6;
}

// ============================================
// ENGLISH LITERATURE MARKING SYSTEM
// ============================================

let pageCounters = { 1: 1, 2: 1, 3: 1, 4: 1, 5: 1, 6: 1 };

function resetWriting1() {
  const container = document.getElementById('question-box-1');
  const linesContainer = document.getElementById('writing-lines-1');
  const lines = linesContainer.querySelectorAll('.writing-line');
  const submitBtn = document.getElementById('submit-button-1');
  const markCounter = document.getElementById('mark-counter-1');
  const addPageBtn = document.getElementById('add-page-btn-1');
  
  const annotations = linesContainer.querySelectorAll('.ai-annotation');
  annotations.forEach(ann => ann.remove());
  
  const additionalPages = document.querySelectorAll('#additional-pages-1 .writing-page');
  additionalPages.forEach(page => {
    const pageAnnotations = page.querySelectorAll('.ai-annotation');
    pageAnnotations.forEach(ann => ann.remove());
  });
  
  lines.forEach(line => {
    line.innerHTML = '';
    line.contentEditable = true;
  });
  
  additionalPages.forEach(page => {
    const pageLines = page.querySelectorAll('.writing-line');
    pageLines.forEach(line => {
      line.innerHTML = '';
      line.contentEditable = true;
    });
  });
  
  const additionalPagesContainer = document.getElementById('additional-pages-1');
  if (additionalPagesContainer) {
    additionalPagesContainer.innerHTML = '';
  }
  
  pageCounters[1] = 1;
  markCounter.textContent = '0/8';
  markCounter.classList.remove('correct', 'incorrect');
  container.classList.remove('correct', 'incorrect-selection', 'marked');
  submitBtn.textContent = 'Submit for Marking';
  submitBtn.onclick = submitWriting1;
  if (addPageBtn) addPageBtn.disabled = false;
  resetProgressSegment(1);
}

async function submitWriting1() {
  const container = document.getElementById('question-box-1');
  const linesContainer = document.getElementById('writing-lines-1');
  const lines = linesContainer.querySelectorAll('.writing-line');
  const submitBtn = document.getElementById('submit-button-1');
  const markCounter = document.getElementById('mark-counter-1');
  
  let studentText = '';
  let allLineData = [];
  
  lines.forEach((line, index) => {
    const text = line.textContent.trim();
    allLineData.push({ text: text, page: 1, lineIndex: index, element: line });
    if (text) studentText += text + ' ';
  });
  
  const additionalPages = document.querySelectorAll('#additional-pages-1 .writing-page');
  additionalPages.forEach((page, pageIndex) => {
    const pageLines = page.querySelectorAll('.writing-line');
    pageLines.forEach((line, lineIndex) => {
      const text = line.textContent.trim();
      allLineData.push({ text: text, page: pageIndex + 2, lineIndex: lineIndex, element: line });
      if (text) studentText += text + ' ';
    });
  });
  
  if (!studentText.trim()) {
    alert('Please write your answer first!');
    return;
  }
  
  submitBtn.disabled = true;
  submitBtn.textContent = 'AI is marking...';
  const addPageBtn = document.getElementById('add-page-btn-1');
  if (addPageBtn) addPageBtn.disabled = true;
  
  allLineData.forEach(lineData => {
    lineData.element.contentEditable = false;
  });
  
  const scanOverlay = document.createElement('div');
  scanOverlay.className = 'scanning-overlay';
  linesContainer.appendChild(scanOverlay);
  
  try {
    const response = await fetch('/api/mark-writing', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        exerciseId: 'English_Lit_Q1',
        studentText: studentText.trim(),
        allLineData: allLineData.map(l => ({ text: l.text, page: l.page, lineIndex: l.lineIndex })),
        questionData: {
          topic: 'Language Analysis',
          question: 'How does the writer use language here to describe the hyena\'s appearance?',
          marks: 8
        }
      })
    });
    
    const result = await response.json();
    
    await new Promise(resolve => setTimeout(resolve, 3000));
    scanOverlay.remove();
    
    await applyMarkingResults(allLineData, result);
    
    markCounter.textContent = `${result.marksAwarded}/8`;
    if (result.marksAwarded >= 6) {
      markCounter.classList.add('correct');
      container.classList.add('correct');
    } else {
      markCounter.classList.add('incorrect');
      container.classList.add('incorrect-selection');
    }
    
    container.classList.add('marked');
    updateProgressSegment(1);
    
    submitBtn.textContent = 'Reset Answer';
    submitBtn.onclick = resetWriting1;
    submitBtn.disabled = false;
    
  } catch (error) {
    console.error('Marking error:', error);
    alert('Error during marking. Please try again.');
    submitBtn.disabled = false;
    submitBtn.textContent = 'Submit for Marking';
    if (addPageBtn) addPageBtn.disabled = false;
    allLineData.forEach(lineData => { lineData.element.contentEditable = true; });
    scanOverlay.remove();
  }
}

async function applyMarkingResults(allLineData, result) {
  const markingByPage = {};
  
  allLineData.forEach((lineData) => {
    const pageKey = `page_${lineData.page}`;
    if (!markingByPage[pageKey]) markingByPage[pageKey] = {};
    markingByPage[pageKey][lineData.lineIndex] = {
      element: lineData.element,
      text: lineData.text,
      annotations: [],
      highlights: []
    };
  });
  
  if (result.annotations) {
    result.annotations.forEach(annotation => {
      const pageKey = `page_${annotation.page}`;
      if (markingByPage[pageKey] && markingByPage[pageKey][annotation.lineIndex]) {
        markingByPage[pageKey][annotation.lineIndex].annotations.push(annotation);
      }
    });
  }
  
  if (result.highlights) {
    result.highlights.forEach(highlight => {
      const pageKey = `page_${highlight.page}`;
      if (markingByPage[pageKey] && markingByPage[pageKey][highlight.lineIndex]) {
        markingByPage[pageKey][highlight.lineIndex].highlights.push(highlight);
      }
    });
  }
  
  for (const pageKey in markingByPage) {
    for (const lineIndex in markingByPage[pageKey]) {
      const lineMarking = markingByPage[pageKey][lineIndex];
      
      if (lineMarking.highlights.length > 0) {
        applyHighlightsToLine(lineMarking.element, lineMarking.text, lineMarking.highlights);
      }
      
      if (lineMarking.annotations.length > 0) {
        await addAnnotationsAboveLine(lineMarking.element, lineMarking.annotations);
      }
      
      await new Promise(resolve => setTimeout(resolve, 300));
    }
  }
}

function applyHighlightsToLine(lineElement, originalText, highlights) {
  highlights.sort((a, b) => a.startChar - b.startChar);
  
  let html = '';
  let lastIndex = 0;
  
  highlights.forEach(highlight => {
    html += escapeHtml(originalText.substring(lastIndex, highlight.startChar));
    const highlightedText = originalText.substring(highlight.startChar, highlight.endChar);
    html += `<span class="highlight-${highlight.color}">${escapeHtml(highlightedText)}</span>`;
    lastIndex = highlight.endChar;
  });
  
  html += escapeHtml(originalText.substring(lastIndex));
  lineElement.innerHTML = html;
}

async function addAnnotationsAboveLine(lineElement, annotations) {
  for (const annotation of annotations) {
    const annotationDiv = document.createElement('div');
    annotationDiv.className = `ai-annotation ${annotation.type}`;
    annotationDiv.textContent = annotation.text;
    lineElement.parentNode.insertBefore(annotationDiv, lineElement);
    await new Promise(resolve => setTimeout(resolve, 200));
  }
}

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

// Progress bar
const totalQuestions = 6;

function initializeProgressBar() {
  const container = document.getElementById('progress-segments');
  if (!container) return;
  
  container.innerHTML = '';
  
  for (let i = 1; i <= totalQuestions; i++) {
    const segment = document.createElement('div');
    segment.className = 'quiz-segment';
    segment.style.width = `${100/totalQuestions}%`;
    segment.id = `segment-${i}`;
    
    const icon = document.createElement('div');
    icon.className = 'quiz-segment-icon';
    icon.id = `icon-${i}`;
    
    segment.appendChild(icon);
    container.appendChild(segment);
  }
}

function updateProgressSegment(questionNumber) {
  const questionBox = document.getElementById(`question-box-${questionNumber}`);
  const segment = document.getElementById(`segment-${questionNumber}`);
  const icon = document.getElementById(`icon-${questionNumber}`);
  
  if (!questionBox || !segment || !icon) return;
  
  let color = 'transparent';
  let iconContent = '';
  
  if (questionBox.classList.contains('correct')) {
    color = '#54d3ab';
    iconContent = '✓';
  } else if (questionBox.classList.contains('incorrect-selection')) {
    color = '#e16280';
    iconContent = '✗';
  }
  
  segment.style.backgroundColor = color;
  icon.innerHTML = iconContent;
}

function resetProgressSegment(questionNumber) {
  const segment = document.getElementById(`segment-${questionNumber}`);
  const icon = document.getElementById(`icon-${questionNumber}`);
  
  if (!segment || !icon) return;
  
  segment.style.backgroundColor = 'transparent';
  icon.innerHTML = '';
}

// Question navigation
let currentQuestionIndex = 1;
const totalQuestionsCount = 6;

function initializeQuestionNavigation() {
  for (let i = 1; i <= totalQuestionsCount; i++) {
    const questionBox = document.getElementById(`question-box-${i}`);
    if (questionBox) {
      questionBox.style.display = i === 1 ? 'block' : 'none';
    }
  }
  updateNavigationButtons();
}

function showQuestion(questionNumber) {
  if (questionNumber < 1 || questionNumber > totalQuestionsCount) return;
  
  for (let i = 1; i <= totalQuestionsCount; i++) {
    const questionBox = document.getElementById(`question-box-${i}`);
    if (questionBox) questionBox.style.display = 'none';
  }
  
  const selectedBox = document.getElementById(`question-box-${questionNumber}`);
  if (selectedBox) {
    selectedBox.style.display = 'block';
    setTimeout(() => { selectedBox.scrollIntoView({ behavior: 'smooth', block: 'start' }); }, 50);
  }
  
  currentQuestionIndex = questionNumber;
  updateNavigationButtons();
}

function nextQuestion() {
  if (currentQuestionIndex < totalQuestionsCount) {
    showQuestion(currentQuestionIndex + 1);
  }
}

function previousQuestion() {
  if (currentQuestionIndex > 1) {
    showQuestion(currentQuestionIndex - 1);
  }
}

function updateNavigationButtons() {
  const prevBtn = document.getElementById('nav-prev-btn');
  const nextBtn = document.getElementById('nav-next-btn');
  const counter = document.getElementById('question-counter');
  
  if (prevBtn) {
    prevBtn.disabled = currentQuestionIndex === 1;
    prevBtn.style.opacity = currentQuestionIndex === 1 ? '0.5' : '1';
  }
  
  if (nextBtn) {
    nextBtn.disabled = currentQuestionIndex === totalQuestionsCount;
    nextBtn.style.opacity = currentQuestionIndex === totalQuestionsCount ? '0.5' : '1';
  }
  
  if (counter) {
    counter.textContent = `Question ${currentQuestionIndex} of ${totalQuestionsCount}`;
  }
}

// Mock backend - Smart Marking
const originalFetch = window.fetch;
window.fetch = async function(url, options) {
  if (url === '/api/mark-writing') {
    await new Promise(resolve => setTimeout(resolve, 2000));
    
    const body = JSON.parse(options.body);
    const studentText = body.studentText.toLowerCase();
    
    // Realistic marking criteria
    const hasQuotes = (studentText.match(/["']/g) || []).length >= 2;
    const hasTechniques = /metaphor|simile|personification|imagery|adjective|verb|alliteration/i.test(studentText);
    const hasExplanation = studentText.length > 80;
    const hasLinkToQuestion = /writer|describe|appearance|language|hyena/i.test(studentText);
    
    let marks = 0;
    if (hasQuotes) marks += 2;
    if (hasTechniques) marks += 2;
    if (hasExplanation) marks += 2;
    if (hasLinkToQuestion) marks += 2;
    
    const mockHighlights = [];
    const mockAnnotations = [];
    
    // Process each line
    body.allLineData.forEach((lineData, index) => {
      const lineText = lineData.text;
      if (!lineText || lineText.length === 0) return;
      
      // Find quotes and highlight green
      const quoteMatches = [...lineText.matchAll(/["']([^"']+)["']/g)];
      quoteMatches.forEach(match => {
        mockHighlights.push({
          page: lineData.page,
          lineIndex: lineData.lineIndex,
          startChar: match.index,
          endChar: match.index + match[0].length,
          color: 'green'
        });
      });
      
      if (quoteMatches.length > 0 && mockAnnotations.filter(a => a.type === 'positive').length === 0) {
        mockAnnotations.push({
          page: lineData.page,
          lineIndex: lineData.lineIndex,
          text: '✓ Good quotations',
          type: 'positive'
        });
      }
      
      // Find technique words and highlight yellow
      const techniques = ['metaphor', 'simile', 'personification', 'imagery', 'adjective', 'alliteration'];
      techniques.forEach(tech => {
        const idx = lineText.toLowerCase().indexOf(tech);
        if (idx !== -1) {
          mockHighlights.push({
            page: lineData.page,
            lineIndex: lineData.lineIndex,
            startChar: idx,
            endChar: idx + tech.length,
            color: 'yellow'
          });
        }
      });
      
      // Add feedback for short answers
      if (index === 0 && lineText.length < 20 && lineText.length > 0) {
        mockAnnotations.push({
          page: lineData.page,
          lineIndex: lineData.lineIndex,
          text: 'Needs more detail - explain the effect',
          type: 'warning'
        });
      }
      
      // Flag vague language
      if (/good|bad|nice|shows|makes/i.test(lineText) && !/because|suggests|implies/i.test(lineText)) {
        const vaguePhraseMatch = lineText.match(/\b(good|bad|nice|shows|makes)\b/i);
        if (vaguePhraseMatch && mockAnnotations.filter(a => a.type === 'warning').length < 2) {
          mockAnnotations.push({
            page: lineData.page,
            lineIndex: lineData.lineIndex,
            text: 'Be more specific - how does it show this?',
            type: 'warning'
          });
        }
      }
    });
    
    // If almost no content, give 0-1 marks
    if (studentText.length < 20) {
      marks = Math.min(marks, 1);
      if (mockAnnotations.length === 0) {
        mockAnnotations.push({
          page: 1,
          lineIndex: 0,
          text: 'Your answer is too short. Add quotations and explain the language.',
          type: 'warning'
        });
      }
    }
    
    return {
      ok: true,
      json: async () => ({
        marksAwarded: marks,
        highlights: mockHighlights,
        annotations: mockAnnotations
      })
    };
  }
  
  return originalFetch(url, options);
};

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  initializeProgressBar();
  initializeQuestionNavigation();
});
</script>
</body>
</html>
